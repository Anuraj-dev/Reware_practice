{% extends 'base.html' %} {% block title %}{{ item.title }} Â· Rewear{% endblock
%} {% block head_extra %}
<style>
  /* Item Show Page Specific Styles */
  .item-hero {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-xl);
    align-items: start;
    margin-bottom: var(--space-xl);
  }

  .item-image-container {
    position: relative;
    overflow: hidden;
    border-radius: var(--radius-xl);
    aspect-ratio: 4/3;
    background: var(--bg-secondary);
    border: 1px solid var(--glass-border);
    box-shadow: var(--shadow-lg);
  }

  .item-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: var(--transition);
  }

  .item-image:hover {
    transform: scale(1.05);
  }

  .item-details {
    background: var(--bg-card);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-xl);
    padding: var(--space-xl);
    backdrop-filter: blur(20px);
    box-shadow: var(--shadow-lg);
  }

  .item-header {
    margin-bottom: var(--space-lg);
  }

  .item-title {
    font-size: clamp(1.5rem, 4vw, 2rem);
    font-weight: 700;
    margin: 0 0 var(--space-md) 0;
    background: linear-gradient(135deg, var(--text), var(--text-light));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1.2;
  }

  .item-badges {
    display: flex;
    gap: var(--space-sm);
    flex-wrap: wrap;
    margin-bottom: var(--space-md);
  }

  .item-description {
    color: var(--text-muted);
    line-height: 1.6;
    margin-bottom: var(--space-lg);
    font-size: 1rem;
  }

  .owner-info {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-lg);
    padding: var(--space-md);
    margin-bottom: var(--space-lg);
  }

  .swap-section {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    margin-bottom: var(--space-lg);
  }

  .swap-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: var(--space-md);
  }

  .swap-modal.active {
    display: flex;
  }

  .swap-modal-content {
    background: var(--bg-card);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-xl);
    padding: var(--space-xl);
    max-width: 600px;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
    backdrop-filter: blur(20px);
    box-shadow: var(--shadow-xl);
    position: relative;
  }

  .modal-close {
    position: absolute;
    top: var(--space-md);
    right: var(--space-md);
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 1.5rem;
    cursor: pointer;
    padding: var(--space-xs);
    border-radius: var(--radius);
    transition: var(--transition);
  }

  .modal-close:hover {
    background: var(--glass);
    color: var(--text);
  }

  .your-items-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: var(--space-md);
    margin-top: var(--space-md);
  }

  .swap-item-card {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-lg);
    padding: var(--space-md);
    cursor: pointer;
    transition: var(--transition);
    text-align: center;
  }

  .swap-item-card:hover {
    background: var(--glass-hover);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .swap-item-card.selected {
    border-color: var(--info);
    background: rgba(6, 182, 212, 0.2);
  }

  .swap-item-image {
    width: 100%;
    height: 120px;
    object-fit: cover;
    border-radius: var(--radius);
    margin-bottom: var(--space-sm);
  }

  .pending-swap-notice {
    background: rgba(245, 158, 11, 0.2);
    border: 1px solid rgba(245, 158, 11, 0.3);
    border-radius: var(--radius-lg);
    padding: var(--space-md);
    margin-bottom: var(--space-lg);
    color: var(--warning);
  }

  .action-buttons {
    display: flex;
    gap: var(--space-md);
    flex-wrap: wrap;
    align-items: center;
  }

  @media (max-width: 768px) {
    .item-hero {
      grid-template-columns: 1fr;
      gap: var(--space-lg);
    }

    .swap-modal-content {
      margin: var(--space-md);
      padding: var(--space-lg);
    }

    .your-items-grid {
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: var(--space-sm);
    }

    .action-buttons {
      flex-direction: column;
      align-items: stretch;
    }
  }
</style>
{% endblock %} {% block content %}
<section class="section">
  <div class="container">
    <div class="item-hero">
      <!-- Item Image -->
      <div class="item-image-container">
        {% if item.image_url %}
        <img
          src="{{ item.image_url }}"
          alt="{{ item.title }}"
          class="item-image" />
        {% else %}
        <img
          src="{{ url_for('static', filename='images/image2.jpg') }}"
          alt="{{ item.title }}"
          class="item-image" />
        {% endif %}
      </div>

      <!-- Item Details -->
      <div class="item-details">
        <div class="item-header">
          <h1 class="item-title">{{ item.title }}</h1>
          <div class="item-badges">
            <span class="badge">{{ item.category }}</span>
            <span class="badge">{{ item.size }}</span>
            <span class="badge points">{{ item.points_cost }} pts</span>
          </div>
        </div>

        {% if item.description %}
        <p class="item-description">{{ item.description }}</p>
        {% endif %}

        <!-- Owner Information -->
        {% if current_user %}
        <div class="owner-info">
          {% if current_user.id == item.user_id %}
          <div
            style="
              display: flex;
              align-items: center;
              gap: var(--space-sm);
              margin-bottom: var(--space-sm);
            ">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <strong>This is your listing</strong>
          </div>
          <p style="margin: 0; color: var(--text-muted); font-size: 0.9rem">
            You have <strong>{{ current_user.points }}</strong> points available
          </p>
          {% else %}
          <div
            style="
              display: flex;
              align-items: center;
              gap: var(--space-sm);
              margin-bottom: var(--space-sm);
            ">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>Listed by <strong>{{ item.owner.username }}</strong></span>
          </div>
          <p style="margin: 0; color: var(--text-muted); font-size: 0.9rem">
            You have <strong>{{ current_user.points }}</strong> points available
          </p>
          {% endif %}
        </div>
        {% endif %}

        <!-- Pending Swap Notice -->
        {% if pending_swap %}
        <div class="pending-swap-notice">
          <div
            style="
              display: flex;
              align-items: center;
              gap: var(--space-sm);
              margin-bottom: var(--space-sm);
            ">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2">
              <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
            </svg>
            <strong>Swap Request Pending</strong>
          </div>
          <p style="margin: 0; font-size: 0.9rem">
            You've already requested to swap
            <strong>{{ pending_swap.offered_item.title }}</strong> for this
            item.
            <a
              href="{{ url_for('item.dashboard') }}"
              style="color: inherit; text-decoration: underline"
              >View in dashboard</a
            >
          </p>
        </div>
        {% endif %}

        <!-- Action Buttons -->
        <div class="action-buttons">
          {% if not current_user %}
          <a href="{{ url_for('auth.login') }}" class="btn">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2">
              <path
                d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4m-5-4l5-5-5-5m5 5H3"></path>
            </svg>
            Login to Request Swap
          </a>
          {% elif current_user.id == item.user_id %}
          <a
            href="{{ url_for('item.renderEditPage', item_id=item.id) }}"
            class="btn secondary">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2">
              <path
                d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path
                d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            Edit Listing
          </a>
          <form
            method="POST"
            action="{{ url_for('item.deleteListing', item_id=item.id) }}"
            style="display: inline">
            <button
              type="submit"
              class="btn ghost"
              onclick="return confirm('Are you sure you want to delete this listing?')">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2">
                <polyline points="3,6 5,6 21,6"></polyline>
                <path
                  d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
              Delete
            </button>
          </form>
          {% elif current_user.is_admin %}
          <a
            href="{{ url_for('item.renderEditPage', item_id=item.id) }}"
            class="btn secondary">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2">
              <path
                d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path
                d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            Edit (Admin)
          </a>
          {% elif not pending_swap %} {% if user_items %}
          <button id="requestSwapBtn" class="btn">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2">
              <path d="M7 7l10 10M7 17L17 7"></path>
            </svg>
            Request Swap
          </button>
          {% else %}
          <div style="text-align: center; color: var(--text-muted)">
            <p style="margin: 0 0 var(--space-sm) 0">You need items to swap</p>
            <a href="{{ url_for('item.renderNewPage') }}" class="btn ghost"
              >Create a Listing</a
            >
          </div>
          {% endif %} {% endif %}

          <a href="{{ url_for('item.index') }}" class="btn ghost">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2">
              <path d="M19 12H5M12 19l-7-7 7-7"></path>
            </svg>
            Back to Listings
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Swap Modal -->
{% if current_user and current_user.id != item.user_id and user_items and not
pending_swap %}
<div id="swapModal" class="swap-modal">
  <div class="swap-modal-content">
    <button class="modal-close" onclick="closeSwapModal()">&times;</button>

    <h2
      style="
        margin: 0 0 var(--space-lg) 0;
        display: flex;
        align-items: center;
        gap: var(--space-sm);
      ">
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2">
        <path d="M7 7l10 10M7 17L17 7"></path>
      </svg>
      Request Item Swap
    </h2>

    <div
      style="
        background: var(--glass);
        border-radius: var(--radius-lg);
        padding: var(--space-md);
        margin-bottom: var(--space-lg);
      ">
      <p style="margin: 0; color: var(--text-muted)">
        You want to swap one of your items for
        <strong style="color: var(--text)">{{ item.title }}</strong>
      </p>
    </div>

    <form
      method="POST"
      action="{{ url_for('item.requestSwap', item_id=item.id) }}"
      id="swapForm">
      <h3 style="margin: 0 0 var(--space-md) 0">Select an item to offer:</h3>

      <div class="your-items-grid">
        {% for user_item in user_items %}
        <div
          class="swap-item-card"
          onclick="selectSwapItem({{ user_item.id }}, this)">
          {% if user_item.image_url %}
          <img
            src="{{ user_item.image_url }}"
            alt="{{ user_item.title }}"
            class="swap-item-image" />
          {% else %}
          <img
            src="{{ url_for('static', filename='images/image1.jpg') }}"
            alt="{{ user_item.title }}"
            class="swap-item-image" />
          {% endif %}
          <h4 style="margin: var(--space-sm) 0; font-size: 0.9rem">
            {{ user_item.title }}
          </h4>
          <div
            style="
              display: flex;
              gap: var(--space-xs);
              justify-content: center;
              margin-bottom: var(--space-sm);
            ">
            <span class="badge" style="font-size: 0.8rem"
              >{{ user_item.category }}</span
            >
            <span class="badge" style="font-size: 0.8rem"
              >{{ user_item.size }}</span
            >
          </div>
          <p style="margin: 0; color: var(--text-muted); font-size: 0.85rem">
            {{ user_item.points_cost }} pts
          </p>
        </div>
        {% endfor %}
      </div>

      <input
        type="hidden"
        name="offered_item_id"
        id="selectedItemId"
        required />

      <div
        style="
          display: flex;
          gap: var(--space-md);
          margin-top: var(--space-xl);
          justify-content: flex-end;
        ">
        <button type="button" onclick="closeSwapModal()" class="btn ghost">
          Cancel
        </button>
        <button type="submit" id="submitSwapBtn" class="btn" disabled>
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2">
            <path d="M7 7l10 10M7 17L17 7"></path>
          </svg>
          Send Swap Request
        </button>
      </div>
    </form>
  </div>
</div>
{% endif %} {% endblock %} {% block scripts %}
<script>
  // Swap Modal Functionality
  function openSwapModal() {
    const modal = document.getElementById("swapModal");
    if (modal) {
      modal.classList.add("active");
      document.body.style.overflow = "hidden";
    }
  }

  function closeSwapModal() {
    const modal = document.getElementById("swapModal");
    if (modal) {
      modal.classList.remove("active");
      document.body.style.overflow = "";

      // Reset selection
      document.querySelectorAll(".swap-item-card.selected").forEach((card) => {
        card.classList.remove("selected");
      });
      document.getElementById("selectedItemId").value = "";
      document.getElementById("submitSwapBtn").disabled = true;
    }
  }

  function selectSwapItem(itemId, cardElement) {
    // Remove previous selection
    document.querySelectorAll(".swap-item-card.selected").forEach((card) => {
      card.classList.remove("selected");
    });

    // Add selection to clicked card
    cardElement.classList.add("selected");

    // Update form
    document.getElementById("selectedItemId").value = itemId;
    document.getElementById("submitSwapBtn").disabled = false;
  }

  // Event Listeners
  document.addEventListener("DOMContentLoaded", function () {
    const requestSwapBtn = document.getElementById("requestSwapBtn");
    if (requestSwapBtn) {
      requestSwapBtn.addEventListener("click", openSwapModal);
    }

    // Close modal when clicking outside
    const swapModal = document.getElementById("swapModal");
    if (swapModal) {
      swapModal.addEventListener("click", function (e) {
        if (e.target === swapModal) {
          closeSwapModal();
        }
      });
    }

    // Handle form submission
    const swapForm = document.getElementById("swapForm");
    if (swapForm) {
      swapForm.addEventListener("submit", function (e) {
        const submitBtn = document.getElementById("submitSwapBtn");
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
                        <path d="M21 12a9 9 0 11-6.219-8.56"></path>
                    </svg>
                    Sending Request...
                `;
        }
      });
    }
  });

  // Add spin animation
  const style = document.createElement("style");
  style.textContent = `
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
`;
  document.head.appendChild(style);
</script>
{% endblock %}
